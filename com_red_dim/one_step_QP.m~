function [torques, lambdas] = one_step_QP(q, dq, new_acc, J_com, Jcomdot)
global robot m
options =  optimoptions('fmincon','Display','off');
J_dash=[-J_com eye(3)];
   
%Torque limit 
   tl=10000; 
   nb=10^8;
   lb=[-nb,-nb,-nb,-nb,-nb,-nb,-tl,-tl,-tl,-nb,-nb,-nb];
   ub=[nb,nb,nb,nb,nb,nb,tl,tl,tl,nb,nb,nb];
   L=blkdiag(tl,tl,tl);
   
   
   
%Dynamic Constraint Equations
   H=massMatrix(robot,q);
   M=blkdiag(H,eye(3)*(m));
   C=velocityProduct(robot,q,dq);
   G=gravityTorque(robot,q);
   hh=C+G;
   h = [hh;
        zeros(3,1)];
     
   S =[1 0 0 0 0 0;
       0 1 0 0 0 0;
       0 0 1 0 0 0];
   
   Jc=[0 0 0 1 0 0;
       0 0 0 0 1 0;
       0 0 0 0 0 1];
   
   A=[M -S' -Jc';
      J_dash zeros([3 6])];

   
   k=Jcomdot*dq;
   
   B=[-h;k];
   
   f=-[0;0;0;new_acc;0;0;0;0;0;0];
   
   
   W_diag = diag([0.0 0.0 0.0 1 1 1 0.0 0.0 0.0 0.0 0.0 0.0]);
   
   
   [x,fval,exitflag,output,lambda]=quadprog(W_diag,f,[],[],A,B,lb,ub,[],options);
   torques = [x(7); x(8); x(9)];
   lambdas = [x(10); x(11); x(12)];
end